<script src="https://cdn.jsdelivr.net/gh/orstavik/parse@v1.0.1/parse.js"></script>
<script src="https://cdn.jsdelivr.net/gh/orstavik/ElementObserver/constructionFrame.js"></script>
<script src="https://cdn.jsdelivr.net/gh/orstavik/customEvents@0.1.3/src/customEventsSync.js"></script>
<script src="../../src/customAttributes.js"></script>

<h1 get-submit="https://httpbin.org/anything?hello=sunshine" log-load="1"></h1>
<h2 formdata-submit="https://httpbin.org/anything?hello=sunshine" log-load="2"></h2>
<h3 uricomponents-submit="https://httpbin.org/anything?hello=sunshine" log-load="3"></h3>

<script type="module">
  import {
    GET_Attr_json,
    POST_formdata_Attr_json,
    POST_uriComponent_Attr_json
  } from "../../src/attributes/navigation2/AjaxAttr.js";


  customAttributes.define("get", GET_Attr_json);
  customAttributes.define("formdata", POST_formdata_Attr_json);
  customAttributes.define("uricomponents", POST_uriComponent_Attr_json);

  const log = {};

  function doLog(k, v) {
    log[k] = v;
    const entries = Object.entries(log);
    if (entries.length === 3)
      console.log(...entries.sort());
  }

  customAttributes.define("log", class LogAttr extends Attr {
    onEvent({detail: {url, method, args, data}}) {
      doLog(this.value, [url, method, args, data]);
    }
  });

  document.querySelector("h1").dispatchEvent(new CustomEvent("submit", {detail: [["hello", "sunshine"]]}));
  document.querySelector("h2").dispatchEvent(new CustomEvent("submit", {detail: [["hello", "sunshine"]]}));
  document.querySelector("h3").dispatchEvent(new CustomEvent("submit", {detail: [["hello", "sunshine"]]}));
</script>